<% if current_user.role.role_name.downcase != "supervisor"%>
<h1>Access Denied</h1>
<%else%>


<div class = "page-header">
  <h4> <%=current_user.department.department_name.titlecase%> Vacation </h4>
</div>

<div class="row">
  <div class="col-md-4 col-md-offset-1">

    <form action = "/my_departments_requests">
      <select name="month" class = "form-control">
        <option value = 1> January </option>
        <option value = 2> February </option>
        <option value = 3> March </option>
        <option value = 4> April </option>
        <option value = 5> May </option>
        <option value = 6> June </option>
        <option value = 7> July </option>
        <option value = 8> August </option>
        <option value = 9> September </option>
        <option value = 10> October  </option>
        <option value = 11> November </option>
        <option value = 12> December  </option>
      </select>

      <%= select_tag(:role_id, options_from_collection_for_select(Role.all, :id, :role_name, @role_filter), :class => "form-control")%>

      <button class="btn btn-success">
        Filter
      </button>


    </form>
  </div>
</div>

<div class="col-md-12">
  <hr>

  <table class="table table-striped table-hover">

    <thead>
      <tr>
        <th>Date</th>
        <th>Role </th>
        <th>Full Day </th>
        <th>AM Half Day </th>
        <th>PM Half Day </th>
      </tr>
    </thead>

    <% @allotments.each do |allotment| %>

    <% days_scheduled = @department_full_day_vacations.where(:allotment_id => allotment.id).count + @department_half_day_vacations.where(:allotment_id => allotment.id).count*0.5%>

    <% employees_off_full_day = @department_full_day_vacations.where(:allotment_id => allotment.id) %>
    <% employees_off_am_half_day = @department_half_day_vacations.where(:allotment_id => allotment.id, :length => "am half day") %>
    <% employees_off_pm_half_day = @department_half_day_vacations.where(:allotment_id => allotment.id, :length => "pm half day") %>

    <% if allotment.date.month == @month_filter && allotment.role.id == @role_filter%>
    <tr>
      <td> <%=allotment.date.strftime("%a %D")%></td>
      <td> <%=allotment.role.role_name%> </td>
      <td> <% employees_off_full_day.each do |employee| %>
        <li><%=employee.user.first_name.capitalize %> <%=employee.user.last_name.capitalize %></li>
        <%end%>
      </td>
      <td> <% employees_off_am_half_day.each do |employee| %>
        <li><%=employee.user.first_name.capitalize %> <%=employee.user.last_name.capitalize %></li>
        <%end%>
      </td>
      <td> <% employees_off_pm_half_day.each do |employee| %>
        <li><%=employee.user.first_name.capitalize %> <%=employee.user.last_name.capitalize %></li>
        <%end%>
      </td>
    </tr>

    <%end%>

    <%end%>

    <%end%>
  </table>
</div>
